<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>Tracking Markers Web</title>
  <style>
    body, html {
      margin: 0;
      padding: 0;
      overflow: hidden;
      height: 100%;
      background-color: #000;
      font-family: 'Roboto', sans-serif;
    }
    #uiBox {
      position: fixed;
      top: 2%;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(68, 68, 68, 0.6);
      color: white;
      padding: 20px;
      border-radius: 15px;
      font-family: 'Roboto', sans-serif;
      z-index: 1000;
      text-align: center;
    }
    #canvas {
      display: block;
      width: 100vw;
      height: 100vh;
    }
    #kbContainer {
      position: fixed;
      bottom: 0;
      left: 0;
      width: 100%;
      height: 100%;
      display: none;
      justify-content: center;
      align-items: flex-end;
      pointer-events: none;
      z-index: 900;
    }
    #kbWrapper {
      position: relative;
      width: 100vw;
      height: 100%;
      display: flex;
      justify-content: center;
      align-items: flex-end;
    }
    #kbImage {
      width: 100vw;
      height: auto;
      object-fit: contain;
      display: block;
      opacity: 0.8;
      position: relative;
      z-index: 1;
    }
    #kbTint {
      position: absolute;
      bottom: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: transparent;
      z-index: 2;
      pointer-events: none;
      mix-blend-mode: multiply;
    }
    #toggleUiBtn {
      position: fixed;
      top: 2%;
      left: 5%;
      transform: translateX(-50%);
      z-index: 1100;
      padding: 10px;
      border-radius: 50%;
      border: none;
      cursor: pointer;
      background-color: #444;
      color: white;
      font-size: 18px;
      display: flex;
      justify-content: center;
      align-items: center;
      width: 40px;
      height: 40px;
    }
    #toggleUiBtn svg {
      width: 20px;
      height: 20px;
      fill: white;
    }
  </style>
  <link href="https://fonts.googleapis.com/css2?family=Roboto&display=swap" rel="stylesheet">
</head>
<body>
  <canvas id="canvas"></canvas>

  <button id="toggleUiBtn">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
      <path d="M19.14,12.94a7.14,7.14,0,0,0,.05-.94,7.14,7.14,0,0,0-.05-.94l2.11-1.65a.5.5,0,0,0,.12-.63l-2-3.46a.5.5,0,0,0-.6-.22l-2.49,1a6.91,6.91,0,0,0-1.63-.94l-.38-2.65A.5.5,0,0,0,13.69,2H10.31a.5.5,0,0,0-.5.42L9.43,5.07a6.91,6.91,0,0,0-1.63.94l-2.49-1a.5.5,0,0,0-.6.22l-2,3.46a.5.5,0,0,0,.12.63L5.14,11.06a7.14,7.14,0,0,0-.05.94,7.14,7.14,0,0,0,.05.94L3,14.59a.5.5,0,0,0-.12.63l2,3.46a.5.5,0,0,0,.6.22l2.49-1a6.91,6.91,0,0,0,1.63.94l.38,2.65a.5.5,0,0,0,.5.42h3.38a.5.5,0,0,0,.5-.42l.38-2.65a6.91,6.91,0,0,0,1.63-.94l2.49,1a.5.5,0,0,0,.6-.22l2-3.46a.5.5,0,0,0-.12-.63ZM12,15.5A3.5,3.5,0,1,1,15.5,12,3.5,3.5,0,0,1,12,15.5Z"/>
    </svg>
  </button>

  <div id="uiBox">
    <label>Background: <input type="color" id="bgColor" value="#000000"></label><br>
    <label>Marker Color: <input type="color" id="markerColor" value="#00ff00"></label><br>
    <label>Size:<br> <input type="range" id="size" min="10" max="100" value="30"></label><br>
    <label>Quantity X:<br> <input type="range" id="quantityX" min="2" max="20" value="5"></label><br>
    <label>Quantity Y:<br> <input type="range" id="quantityY" min="2" max="20" value="5"></label><br>
    <label>Padding:<br> <input type="range" id="spacing" min="0" max="200" value="50"></label><br>
    <label>Shape:<br> 
      <select id="shape">
        <option value="circle" selected>Circle</option>
        <option value="cross">Cross</option>
        <option value="marker">Marker</option>
      </select>
    </label><br>
    <label>Opacity:<br> <input type="range" id="kbOpacity" min="0" max="100" value="50"></label><br>
    <label>Tint Color: <input type="color" id="kbTintColor" value="#ff0000"></label><br>
    <label>Tint Strength:<br> <input type="range" id="kbTintStrength" min="0" max="100" value="30"></label><br>
    <button id="fullscreenBtn">Fullscreen</button>
    <button id="kbBtn">KB</button>
  </div>

  <div id="kbContainer">
    <div id="kbWrapper">
      <img id="kbImage" src="https://raw.githubusercontent.com/jangarit/jangarit.github.io/refs/heads/master/projects/ScreenMarkersApp/images/KB.jpg" alt="Keyboard Image">
      <div id="kbTint"></div>
    </div>
  </div>

  <script>
    const canvas = document.getElementById('canvas');
    const ctx = canvas.getContext('2d');
    const bgColorPicker = document.getElementById('bgColor');
    const markerColorPicker = document.getElementById('markerColor');
    const sizeSlider = document.getElementById('size');
    const quantityXSlider = document.getElementById('quantityX');
    const quantityYSlider = document.getElementById('quantityY');
    const spacingSlider = document.getElementById('spacing');
    const shapeSelect = document.getElementById('shape');
    const fullscreenBtn = document.getElementById('fullscreenBtn');
    const kbBtn = document.getElementById('kbBtn');
    const kbContainer = document.getElementById('kbContainer');
    const kbImage = document.getElementById('kbImage');
    const kbOpacity = document.getElementById('kbOpacity');
    const kbTint = document.getElementById('kbTint');
    const kbTintColor = document.getElementById('kbTintColor');
    const kbTintStrength = document.getElementById('kbTintStrength');
    const toggleUiBtn = document.getElementById('toggleUiBtn');
    const uiBox = document.getElementById('uiBox');

    let markerImg = null;
    let markerImgLoaded = false;

    function loadMarkerFromURL(src) {
      markerImgLoaded = false;
      const img = new Image();
      img.onload = () => {
        if (img.naturalWidth > 0) {
          markerImg = img;
          markerImgLoaded = true;
          drawMarkers();
        } else {
          console.error("Marker image loaded but has no natural width.");
        }
      };
      img.onerror = () => {
        console.error("Failed to load marker image: " + src);
        markerImg = null;
        markerImgLoaded = false;
        drawMarkers();
      };
      img.src = src;
    }

    // Load default marker
    loadMarkerFromURL("https://raw.githubusercontent.com/jangarit/jangarit.github.io/refs/heads/master/projects/ScreenMarkersApp/images/MarkerA.png");

    function resizeCanvas() {
      canvas.width = window.innerWidth * window.devicePixelRatio;
      canvas.height = window.innerHeight * window.devicePixelRatio;
      ctx.setTransform(1,0,0,1,0,0);
      ctx.scale(window.devicePixelRatio, window.devicePixelRatio);
      drawMarkers();
    }

    function drawMarkers() {
      const width = window.innerWidth;
      const height = window.innerHeight;
      ctx.fillStyle = bgColorPicker.value;
      ctx.fillRect(0, 0, width, height);

      const quantityX = parseInt(quantityXSlider.value);
      const quantityY = parseInt(quantityYSlider.value);
      const size = parseInt(sizeSlider.value);
      const shape = shapeSelect.value;
      const padding = parseInt(spacingSlider.value);
      ctx.fillStyle = markerColorPicker.value;

      const availableWidth = width - 2 * padding;
      const availableHeight = height - 2 * padding;

      const xSpacing = quantityX > 1 ? availableWidth / (quantityX - 1) : 0;
      const ySpacing = quantityY > 1 ? availableHeight / (quantityY - 1) : 0;

      for (let i = 0; i < quantityX; i++) {
        for (let j = 0; j < quantityY; j++) {
          const x = padding + i * xSpacing;
          const y = padding + j * ySpacing;

          if (shape === 'circle') {
            ctx.beginPath();
            ctx.arc(x, y, size/2, 0, Math.PI * 2);
            ctx.fill();
          } else if (shape === 'cross') {
            ctx.beginPath();
            ctx.moveTo(x - size/2, y - size/2);
            ctx.lineTo(x + size/2, y + size/2);
            ctx.moveTo(x + size/2, y - size/2);
            ctx.lineTo(x - size/2, y + size/2);
            ctx.strokeStyle = markerColorPicker.value;
            ctx.lineWidth = 2;
            ctx.stroke();
          } else if (shape === 'marker') {
            if (markerImgLoaded && markerImg && markerImg.naturalWidth > 0) {
              try {
                ctx.drawImage(markerImg, x - size/2, y - size/2, size, size);
              } catch (err) {
                console.error("drawImage failed", err);
              }
            }
          }
        }
      }
    }

    bgColorPicker.addEventListener('input', drawMarkers);
    markerColorPicker.addEventListener('input', drawMarkers);
    sizeSlider.addEventListener('input', drawMarkers);
    quantityXSlider.addEventListener('input', drawMarkers);
    quantityYSlider.addEventListener('input', drawMarkers);
    spacingSlider.addEventListener('input', drawMarkers);
    shapeSelect.addEventListener('change', drawMarkers);

    fullscreenBtn.addEventListener('click', () => {
      if (!document.fullscreenElement) {
        document.documentElement.requestFullscreen().catch(() => {
          // fallback CSS fullscreen for iOS
          document.documentElement.style.position = 'fixed';
          document.documentElement.style.top = 0;
          document.documentElement.style.left = 0;
          document.documentElement.style.width = '100%';
          document.documentElement.style.height = '100%';
        });
      } else {
        document.exitFullscreen().catch(() => {
          document.documentElement.style.position = '';
          document.documentElement.style.width = '';
          document.documentElement.style.height = '';
        });
      }
    });

    kbBtn.addEventListener('click', () => {
      kbContainer.style.display = kbContainer.style.display === 'flex' ? 'none' : 'flex';
    });

    kbOpacity.addEventListener('input', () => {
      kbImage.style.opacity = kbOpacity.value / 100;
    });

    kbTintColor.addEventListener('input', updateTint);
    kbTintStrength.addEventListener('input', updateTint);

    function updateTint() {
      const color = kbTintColor.value;
      const strength = kbTintStrength.value / 100;
      kbTint.style.backgroundColor = hexToRgba(color, strength);
    }

    function hexToRgba(hex, alpha) {
      const r = parseInt(hex.slice(1, 3), 16);
      const g = parseInt(hex.slice(3, 5), 16);
      const b = parseInt(hex.slice(5, 7), 16);
      return `rgba(${r}, ${g}, ${b}, ${alpha})`;
    }

    toggleUiBtn.addEventListener('click', () => {
      uiBox.style.display = uiBox.style.display === 'none' ? 'block' : 'none';
    });

    window.addEventListener('resize', resizeCanvas);
    resizeCanvas();

    // --- Block zoom, scroll, pan globally but allow UI controls ---
    function isFormElement(el) {
      return ['INPUT', 'SELECT', 'TEXTAREA', 'BUTTON'].includes(el.tagName);
    }

    document.addEventListener('keydown', (e) => {
      if ((e.ctrlKey || e.metaKey) && ['+', '-', '=', '0'].includes(e.key)) {
        e.preventDefault();
      }
    });

    let lastTouchEnd = 0;
    document.addEventListener('touchend', (e) => {
      const now = Date.now();
      if (now - lastTouchEnd <= 300 && !isFormElement(e.target)) {
        e.preventDefault();
      }
      lastTouchEnd = now;
    }, { passive: false });

    document.addEventListener('touchmove', (e) => {
      if (e.touches.length > 1 && !isFormElement(e.target)) {
        e.preventDefault();
      }
    }, { passive: false });

    document.addEventListener('wheel', (e) => {
      if (!isFormElement(e.target)) {
        e.preventDefault();
      }
    }, { passive: false });

    document.body.style.overflow = 'hidden';
    document.documentElement.style.overflow = 'hidden';
  </script>
</body>
</html>
